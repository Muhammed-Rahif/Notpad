name: Greet, Celebrate, and Encourage

on:
  issues:
    types:
      - opened
      - assigned
  pull_request:
    types:
      - opened
  pull_request_target:
    types:
      - closed

jobs:
  greet:
    runs-on: ubuntu-latest

    steps:
      - name: Check User Contributions
        id: check_contributions
        uses: actions/github-script@v7
        with:
          script: |
            const user = context.payload.sender.login;
            const [issues, pulls] = await Promise.all([
              github.rest.issues.listForRepo({
                owner: context.repo.owner,
                repo: context.repo.repo,
                creator: user,
                state: 'all'
              }),
              github.rest.pulls.list({
                owner: context.repo.owner,
                repo: context.repo.repo,
                state: 'all',
                creator: user
              })
            ]);
            const totalContributions = issues.data.length + pulls.data.length;
            core.setOutput('isFirstTime', totalContributions === 1);
            core.setOutput('totalContributions', totalContributions);

      - name: Post Personalized Greeting
        if: ${{ steps.check_contributions.outputs.isFirstTime == 'true' || steps.check_contributions.outputs.totalContributions == '5' || github.event_name == 'issues' || github.event_name == 'pull_request' }}
        uses: actions/github-script@v7
        with:
          script: |
            const user = context.payload.sender.login;
            const issueOrPr = context.payload.issue || context.payload.pull_request;
            const isIssue = !!context.payload.issue;
            const isPR = !!context.payload.pull_request;
            const isFirstTime = ${steps.check_contributions.outputs.isFirstTime} === 'true';
            const totalContributions = parseInt(${steps.check_contributions.outputs.totalContributions});
            let message = '';

            if (isFirstTime) {
              message = `ğŸ‰ Welcome aboard, @${user}! ğŸš€  
              We're excited to see your **first contribution** to **Notpad**! ğŸŒŸ  
              Every great project starts with contributors like you. ğŸ’¡  
              Take a moment to check out our [CONTRIBUTING.md](https://github.com/Muhammed-Rahif/Notpad/blob/main/CONTRIBUTING.md) for tips and guidelines.  
              Feel free to explore, experiment, and engage with the community.  
              Your journey in open source starts here â€“ happy coding! ğŸ–¥ï¸`;
            }

            if (isIssue) {
              message += `  
              ğŸ‘‹ Hi @${user}! Thank you for taking the time to report an issue in **Notpad**.  
              Weâ€™ll dive into it shortly. ğŸ•µï¸â€â™‚ï¸ğŸ”§  
              While you're here, why not add a â­ to the repo? [Click here to star](https://github.com/Muhammed-Rahif/Notpad/stargazers).  
              Your support helps us grow this project and reach more awesome contributors like you! ğŸš€`;
            }

            if (isPR) {
              message += `  
              ğŸ™Œ Woohoo, @${user}! Thanks for opening a pull request to **Notpad**. ğŸ› ï¸âœ¨  
              Your efforts make this project better with every contribution.  
              ğŸ’¡ Before we merge this, donâ€™t forget to check our [CONTRIBUTING.md](https://github.com/Muhammed-Rahif/Notpad/blob/main/CONTRIBUTING.md) for a smoother process.  
              Together, weâ€™re building something incredible â€“ keep up the amazing work! ğŸ’ª  
              (Psst... have you starred the repo yet? â­)`;
            }

            if (totalContributions === 5) {
              message += `  
              ğŸŠ High five, @${user}! âœ‹ Youâ€™ve just hit a major milestone â€“ **5 contributions** to **Notpad**!  
              Contributors like you make this project shine brighter every day. ğŸŒŸ  
              Your dedication inspires us, and we canâ€™t wait to see what you come up with next.  
              A big thank you from the entire **Notpad** team â€“ we deeply appreciate your support. ğŸ™  
              Letâ€™s keep building and making open source awesome together! ğŸš€`;
            }

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueOrPr.number,
              body: message
            });

      - name: Assign User Guidance
        if: ${{ github.event.action == 'assigned' && steps.check_contributions.outputs.totalContributions < 3 }}
        uses: actions/github-script@v7
        with:
          script: |
            const assignee = context.payload.assignee.login;
            const issueNumber = context.payload.issue.number;
            const message = `ğŸ› ï¸ **Heads up, @${assignee}!**  
            You've been assigned an issue in **Notpad** â€“ ready to make your mark? ğŸš€  
            Since you're relatively new here, we highly recommend checking out our [CONTRIBUTING.md](https://github.com/Muhammed-Rahif/Notpad/blob/main/CONTRIBUTING.md).  
            Itâ€™s packed with helpful tips, guidelines, and best practices to ensure a smooth contribution experience.  
            Weâ€™re excited to see what youâ€™ll bring to the table â€“ happy coding! ğŸ’»âœ¨`;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              body: message
            });

      - name: Thank Contributor When PR is Merged
        if: github.event.action == 'closed' && github.event.pull_request.merged == true
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const message = `ğŸ‰ Congratulations, @${pr.user.login}! Your pull request has been successfully merged. ğŸ¥³ğŸˆ  
            Youâ€™ve just made **Notpad** better, and we couldnâ€™t be more thankful. ğŸ™Œ  
            Your contribution is now part of the project, helping users and contributors around the world. ğŸŒ  
            Weâ€™re excited to see what else you have in store for us â€“ the best is yet to come! ğŸ’¡  
            Cheers to you and the amazing world of open source! ğŸ»âœ¨`;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.number,
              body: message
            });
